<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DropX - File Sharing</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="style.css" />
  <style>
    body { font-family: 'Inter', sans-serif; }
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
  </style>
</head>
<body class="bg-gray-100 text-gray-900 flex overflow-hidden h-screen">

  <!-- ===== Left Sidebar ===== -->
  <aside class="w-64 bg-white p-6 flex flex-col h-screen fixed top-0 left-0 shadow-lg z-10">
    <div class="h-12 flex items-center mb-6">
      <span class="text-3xl font-bold text-indigo-600">DropX</span>
    </div>

    <label for="sidebarFileInput" class="w-full bg-indigo-600 text-white rounded-lg p-3 flex items-center justify-center font-semibold shadow-md hover:bg-indigo-700 transition-colors duration-200 cursor-pointer">
      <i data-lucide="plus" class="mr-2 h-5 w-5"></i> Start File Transfer
      <input type="file" id="sidebarFileInput" multiple style="display:none">
    </label>

    <nav class="flex-1 flex flex-col mt-8">
      <div class="space-y-2">
        <a href="#" class="nav-link flex items-center p-3 rounded-lg bg-indigo-100 text-indigo-700 font-semibold" data-section="devices">
          <i data-lucide="laptop" class="mr-3 h-5 w-5"></i> Connected Devices
        </a>
        <a href="#" class="nav-link flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-200" data-section="transfers">
          <i data-lucide="arrow-left-right" class="mr-3 h-5 w-5"></i> Active Transfers
        </a>
        <a href="#" class="nav-link flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-200" data-section="history">
          <i data-lucide="history" class="mr-3 h-5 w-5"></i> History
        </a>
      </div>
      <div class="mt-auto">
        <a href="#" class="nav-link flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-200" data-section="about">
          <i data-lucide="info" class="mr-3 h-5 w-5"></i> About DropX
        </a>
      </div>
    </nav>
  </aside>

  <!-- ===== Main Content Area ===== -->
  <main class="ml-64 p-8 flex-1 h-screen overflow-y-auto">
    <header class="flex justify-between items-center mb-8">
      <div class="relative">
        <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5"></i>
        <input type="search" placeholder="Search connected devices or transfers..." class="pl-12 pr-4 py-3 rounded-lg border border-gray-300 bg-white w-96 focus:outline-none focus:ring-2 focus:ring-indigo-500">
      </div>
    </header>

    <!-- Devices Page -->
    <div id="page-devices" class="page-content">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <section class="card bg-white p-6 rounded-lg shadow-md h-full">
          <h2 class="text-xl font-semibold mb-4">Connected Devices</h2>
          <div class="space-y-2">
            <div id="myId" class="text-gray-700"><strong>You:</strong> ...</div>
            <div id="status" class="text-gray-500"><strong>Status:</strong> Connecting...</div>
          </div>
        </section>

        <section class="card bg-white p-6 rounded-lg shadow-md h-full">
          <h3 class="text-xl font-semibold mb-4">Peers</h3>
          <ul id="peers" class="space-y-1"></ul>
          <div class="text-gray-500 no-peers">
            <p>No devices found. Open DropX on other devices to send files.</p>
          </div>
        </section>

        <section class="card bg-white p-6 rounded-lg shadow-md h-full flex flex-col">
          <div id="dropzone" class="border-2 border-dashed border-gray-400 rounded-lg w-full flex-1 min-h-[150px] flex flex-col items-center justify-center cursor-pointer hover:border-indigo-500 transition-colors duration-200 bg-gray-50/50 p-4">
            <p class="text-gray-500 mb-4 text-lg">Drag & Drop Files Here</p>
          </div>
          <button id="chooseBtn" class="w-full mt-4 bg-indigo-800 text-white rounded-lg px-6 py-3 font-semibold hover:bg-indigo-900 transition-colors duration-200">
            Choose File
          </button>
          <input type="file" id="fileInput" multiple style="display:none">
          <p id="fileInfo" class="mt-4 text-sm text-gray-600 px-4 text-center"></p>
        </section>

        <section class="card bg-white p-6 rounded-lg shadow-md h-full">
          <h3 class="text-xl font-semibold mb-4">Active Transfers</h3>
          <div id="transfers">
            <p class="text-gray-500">No active transfers.</p>
          </div>
        </section>
      </div>
    </div>

    <!-- Active Transfers Page -->
    <div id="page-transfers" class="page-content hidden">
      <section class="bg-white p-6 rounded-lg shadow-md h-full">
        <h2 class="text-xl font-semibold mb-4">All Active Transfers</h2>
        <div id="activeTransfersList" class="space-y-3">
          <p class="text-gray-500">No active transfers in progress.</p>
        </div>
      </section>
    </div>

    <!-- History Page -->
    <div id="page-history" class="page-content hidden">
      <section class="bg-white p-6 rounded-lg shadow-md h-full">
        <h2 class="text-xl font-semibold mb-4">Transfer History</h2>
        <ul id="historyList" class="space-y-2 text-gray-700">
          <li class="text-gray-500">No completed transfers yet.</li>
        </ul>
      </section>
    </div>

    <!-- About Page -->
    <div id="page-about" class="page-content hidden">
      <section class="bg-white p-6 rounded-lg shadow-md h-full">
        <h2 class="text-xl font-semibold mb-4">About DropX</h2>
        <p class="text-gray-700">DropX is a lightweight, local-network file sharing application inspired by Snapdrop and PairDrop.</p>
        <p class="mt-4 text-gray-700">It is designed for speed, simplicity, and privacy.</p>
        <p class="mt-8 text-gray-500 text-sm">Version 1.1.0</p>
      </section>
    </div>
  </main>

  <!-- Offline Overlay -->
  <div id="offlineOverlay" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg text-center">
      <h2 class="text-lg font-semibold mb-4 text-red-600">Connection Lost</h2>
      <p class="mb-4">Trying to reconnect...</p>
      <button id="retryConnect" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Retry</button>
    </div>
  </div>

  <!-- Connection Status -->
  <div id="connectionState" class="fixed bottom-2 right-4 bg-gray-800 text-white px-3 py-1 rounded text-sm shadow-md">
    Connecting...
  </div>

  <!-- Defer the app to ensure DOM exists -->
  <script src="app.js" defer></script>
  <script>
    lucide.createIcons();

    // Sidebar page switching
    const navLinks = document.querySelectorAll('.nav-link');
    const pages = document.querySelectorAll('.page-content');

    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        navLinks.forEach(l => l.classList.remove('bg-indigo-100', 'text-indigo-700', 'font-semibold'));
        link.classList.add('bg-indigo-100', 'text-indigo-700', 'font-semibold');
        const target = 'page-' + link.dataset.section;
        pages.forEach(p => p.classList.add('hidden'));
        const page = document.getElementById(target);
        if (page) page.classList.remove('hidden');
      });
    });

    // Real-time UI API for app.js
    window.DropXUI = {
      addTransfer(filename) {
        const box = document.createElement('div');
        box.className = 'p-3 border rounded bg-gray-50';
        box.innerHTML = `<strong>Transferring:</strong> ${filename}
          <div class="w-full bg-gray-300 h-2 mt-2 rounded"><div class="progress bg-indigo-600 h-2 w-0 rounded"></div></div>`;
        document.getElementById('activeTransfersList')?.prepend(box);
        return box.querySelector('.progress');
      },
      updateProgress(progressEl, sent, total) {
        const pct = Math.round((sent / total) * 100);
        if (progressEl) progressEl.style.width = pct + '%';
      },
      addHistory(filename, direction) {
        const history = document.getElementById('historyList');
        if (!history) return;
        const li = document.createElement('li');
        const color = direction === 'sent' ? 'text-blue-600' : 'text-green-600';
        li.innerHTML = `<span class="${color} font-semibold">${filename}</span> ${direction === 'sent' ? 'sent' : 'received'}.`;
        history.prepend(li);
      }
    };
  </script>
</body>
</html>